(function(e){function t(t){for(var r,n,i=t[0],l=t[1],u=t[2],m=0,f=[];m<i.length;m++)n=i[m],Object.prototype.hasOwnProperty.call(a,n)&&a[n]&&f.push(a[n][0]),a[n]=0;for(r in l)Object.prototype.hasOwnProperty.call(l,r)&&(e[r]=l[r]);c&&c(t);while(f.length)f.shift()();return o.push.apply(o,u||[]),s()}function s(){for(var e,t=0;t<o.length;t++){for(var s=o[t],r=!0,i=1;i<s.length;i++){var l=s[i];0!==a[l]&&(r=!1)}r&&(o.splice(t--,1),e=n(n.s=s[0]))}return e}var r={},a={app:0},o=[];function n(t){if(r[t])return r[t].exports;var s=r[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=r,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(s,r,function(t){return e[t]}.bind(null,r));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/static/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],l=i.push.bind(i);i.push=t,i=i.slice();for(var u=0;u<i.length;u++)t(i[u]);var c=l;o.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("56d7")},"034f":function(e,t,s){"use strict";var r=s("64a9"),a=s.n(r);a.a},"56d7":function(e,t,s){"use strict";s.r(t);s("cadf"),s("551c"),s("f751"),s("097d");var r=s("2b0e"),a=s("5f5b"),o=(s("f9e3"),s("2dd8"),function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"app"}},[s("router-view")],1)}),n=[],i=(s("034f"),s("2877")),l={},u=Object(i["a"])(l,o,n,!1,null,null,null),c=u.exports,m=s("8c4f"),f=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"home-page"}},[s("GlobalHeader"),s("GlobalMessage"),s("main",{staticClass:"container"},[s("p",{staticClass:"h5 mb-4"},[e._v("ホーム")]),s("b-form",{on:{submit:function(t){return t.preventDefault(),e.submitSave(t)}}},[s("div",{staticClass:"row form-group"},[s("label",{staticClass:"col-sm-3 col-form-label"},[e._v("タイトル")]),s("div",{staticClass:"col-sm-8"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.form.book.title,expression:"form.book.title"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:e.form.book.title},on:{input:function(t){t.target.composing||e.$set(e.form.book,"title",t.target.value)}}})])]),s("div",{staticClass:"row form-group"},[s("label",{staticClass:"col-sm-3 col-form-label"},[e._v("価格")]),s("div",{staticClass:"col-sm-8"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.form.book.price,expression:"form.book.price"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:e.form.book.price},on:{input:function(t){t.target.composing||e.$set(e.form.book,"price",t.target.value)}}})])]),s("div",{staticClass:"row text-center mt-5"},[s("div",{staticClass:"col-sm-12"},[s("b-button",{attrs:{type:"submit",variant:"primary"}},[e._v(e._s(e.isCreated?"更 新":"登 録"))])],1)])])],1)],1)},p=[],d=(s("ac6a"),s("8615"),s("bc3a")),g=s.n(d),b=s("2f62");r["default"].use(b["a"]);var v={strict:!1,namespaced:!0,state:{username:"",isLoggedIn:!1,isSuperUser:!1,isStaff:!1,isActive:!1},getters:{username:function(e){return e.username},isLoggedIn:function(e){return e.isLoggedIn},isSuperUser:function(e){return e.isSuperUser},isStaff:function(e){return e.isStaff},isActive:function(e){return e.isActive}},mutations:{set:function(e,t){e.username=t.user.username,e.isLoggedIn=!0,e.isSuperUser=t.user.is_superuser,e.isStaff=t.user.is_staff,e.isActive=t.user.is_active},cleare:function(e){e.username="",e.isLoggedIn=!1,e.isSuperUser=!1,e.isStaff=!1,e.isActive=!1}},actions:{login:function(e,t){return x.post("/auth/jwt/create/",{username:t.username,password:t.password}).then((function(t){return localStorage.setItem("access",t.data.access),e.dispatch("reload").then((function(e){return e}))}))},logout:function(e){localStorage.removeItem("access"),e.commit("clear")},reload:function(e){return x.get("/auth/users/me/").then((function(t){var s=t.data;return console.log(s),e.commit("set",{user:s}),s}))}}},h={strict:!1,namespaced:!0,state:{error:"",warnings:[],info:""},getters:{error:function(e){return e.error},warnings:function(e){return e.warnings},info:function(e){return e.info}},mutations:{set:function(e,t){t.error&&(e.error=t.error),t.warnings&&(e.warnings=t.warnings),t.info&&(e.info=t.info)},clear:function(e){e.error="",e.warnings=[],e.info=""}},actions:{setErrorMessage:function(e,t){e.commit("clear"),e.commit("set",{error:t.message})},setWarningMesssages:function(e,t){e.commit("clear"),e.commit("set",{warnings:t.message})},setInfoMessage:function(e,t){e.commit("clear"),e.commit("set",{info:t.message})},clearMessages:function(e){e.commit("clear")}}},w=new b["a"].Store({modules:{auth:v,message:h}}),_=w,C=g.a.create({baseURL:"/api/v1/",timeout:5e3,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}});C.interceptors.request.use((function(e){_.dispatch("message/clearMessages");var t=localStorage.getItem("access");return t?(e.headers.Authorization="JWT "+t,e):e}),(function(e){return Promise.reject(e)})),C.interceptors.response.use((function(e){return e}),(function(e){console.log("error.response=",e.response);var t,s=e.response?e.response.status:500;if(400===s){var r=[].concat.apply([],Object.values(e.response.data));_.dispatch("message/setWarningMessages",{messages:r})}else if(401===s){var a=localStorage.getItem("access");t=null!=a?"ログイン有効期限切れ":"認証エラー",_.dispatch("auth/logout"),_.dispatch("message/setErrorMessage",{message:t})}else 403===s?(t="権限エラーです。",_.dispatch("message/setErrorMessage",{message:t})):(t="想定外のエラーです。",_.dispatch("message/setErrorMessage",{message:t}));return Promise.reject(e)}));var x=C,S=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"header"}},[s("b-navbar",{attrs:{type:"dark",variant:"dark"}},[s("a",{staticClass:"navbar-brand",attrs:{href:"/"}},[e._v("DRF Sample")]),e.$route.meta.requiresAuth?s("b-navbar-nav",{staticClass:"ml-auto"},[e.isLoggedIn?s("b-nav-item-dropdown",{attrs:{right:""}},[s("template",{slot:"button-content"},[e._v(e._s(e.username))]),s("b-dropdown-item",{attrs:{href:"#"},on:{click:e.clickLogout}},[e._v("ログアウト")])],2):e._e()],1):e._e()],1)],1)},y=[],k=(s("a481"),{computed:{username:function(){return this.$store.getters["auth/username"]},isLoggedIn:function(){return this.$store.getters["auth/isLoggedIn"]}},methods:{clickLogout:function(){this.$store.dispatch("auth/logout"),this.$store.dispatch("message/setInfoMessage",{message:"ログアウトしました。"}),this.$router.replace("/login")},clickLogin:function(){this.$store.dispatch("message/clearMessages"),this.$router.replace("/login")}}}),$=k,M=Object(i["a"])($,S,y,!1,null,null,null),j=M.exports,G=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"messages"}},[s("b-alert",{directives:[{name:"show",rawName:"v-show",value:e.message.error,expression:"message.error"}],staticClass:"mb-0",attrs:{variant:"danger",show:""}},[e._v("\n    "+e._s(e.message.error)+"\n  ")]),s("b-alert",{directives:[{name:"show",rawName:"v-show",value:e.message.warnings.length>0,expression:"message.warnings.length > 0"}],staticClass:"mb-0",attrs:{variant:"warning",show:""}},e._l(e.message.warnings,(function(t,r){return s("p",{key:r,staticClass:"mb-0"},[e._v(e._s(t))])})),0),s("b-alert",{directives:[{name:"show",rawName:"v-show",value:e.message.info,expression:"message.info"}],staticClass:"mb-0",attrs:{variant:"info",show:""}},[e._v("\n    "+e._s(e.message.info)+"\n  ")])],1)},A=[],I={computed:{message:function(){return this.$store.state.message}}},O=I,L=Object(i["a"])(O,G,A,!1,null,null,null),U=L.exports,E={components:{GlobalHeader:j,GlobalMessage:U},data:function(){return{form:{book:{title:"",price:0}}}},computed:{isCreated:function(){return void 0!==this.form.book.id}},methods:{submitSave:function(){var e=this;x({method:this.isCreated?"put":"post",url:this.isCreated?"/books/"+this.form.book.id+"/":"/books/",data:{id:this.form.book.id,title:this.form.book.title,price:this.form.book.price}}).then((function(t){var s=e.isCreated?"更新しました。":"登録しました。";e.$store.dispatch("message/setInfoMessage",{message:s}),e.form.book=t.data}))}}},P=E,q=Object(i["a"])(P,f,p,!1,null,null,null),H=q.exports,T=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"login-page"}},[s("GlobalHeader"),s("GlobalMessage"),s("main",{staticClass:"container"},[s("p",{staticClass:"h5 mb-4"},[e._v("ログイン")]),s("b-form",{on:{submit:function(t){return t.preventDefault(),e.submitLogin(t)}}},[s("div",{staticClass:"row form-group"},[s("label",{staticClass:"col-sm-3 col-form-label"},[e._v("ユーザー名")]),s("div",{staticClass:"col-sm-8"},[s("b-form-input",{attrs:{type:"text",required:""},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1)]),s("div",{staticClass:"row form-group"},[s("label",{staticClass:"col-sm-3 col-form-label"},[e._v("パスワード")]),s("div",{staticClass:"col-sm-8"},[s("b-form-input",{attrs:{type:"password",required:""},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1)]),s("div",{staticClass:"row text-center mt-5"},[s("div",{staticClass:"col-sm-12"},[s("b-button",{attrs:{type:"submit",variant:"primary"}},[e._v("ログイン")])],1)])])],1)],1)},N=[],R={components:{GlobalHeader:j,GlobalMessage:U},data:function(){return{form:{username:"",password:""}}},methods:{submitLogin:function(){var e=this;this.$store.dispatch("auth/login",{username:this.form.username,password:this.form.password}).then((function(){console.log("Login succeeded."),e.$store.dispatch("message/setInfoMessage",{message:"ログインしました。"});var t=e.$route.query.next||"/";e.$router.replace(t)}))}}},D=R,W=Object(i["a"])(D,T,N,!1,null,null,null),J=W.exports,z=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"users-page"}},[s("GlobalHeader"),s("GlobalMessage"),s("main",{staticClass:"container",attrs:{id:"userspage"}},[s("p",{staticClass:"h5 mb-4"},[e._v("ホーム")]),s("div",{staticClass:"row"},e._l(e.users,(function(t,r){return s("div",{key:r,staticClass:"col-xs-6 col-md-4"},[s("b-card-group",{attrs:{deck:""}},[s("b-card",{attrs:{header:t.username}},[s("b-list-group",[s("b-list-group-item",[e._v(e._s(t.url))]),s("b-list-group-item",[e._v(e._s(t.email))]),s("b-list-group-item",[e._v(e._s(t.is_staff))])],1)],1)],1)],1)})),0)])],1)},F=[],X={components:{GlobalHeader:j,GlobalMessage:U},data:function(){return{users:[]}},created:function(){var e=this;x.get("/users/").then((function(t){e.users=t.data}))}},B=X,K=Object(i["a"])(B,z,F,!1,null,null,null),Q=K.exports,V=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"user-create-page"}},[s("GlobalHeader"),s("GlobalMessage"),s("main",{staticClass:"container"},[s("p",{staticClass:"h5 mb-4"},[e._v("ユーザー登録")]),s("b-form",{on:{submit:function(t){return t.preventDefault(),e.submitRegister(t)}}},[s("b-form-group",{attrs:{label:"ユーザー名","label-for":"input-user"}},[s("b-form-input",{attrs:{id:"iput-user",type:"text",placeholder:"ユーザー名"},model:{value:e.form.user.username,callback:function(t){e.$set(e.form.user,"username",t)},expression:"form.user.username"}})],1),s("b-form-group",{attrs:{label:"メールアドレス","label-for":"input-email"}},[s("b-form-input",{attrs:{id:"iput-email",type:"email",placeholder:"メールアドレス"},model:{value:e.form.user.email,callback:function(t){e.$set(e.form.user,"email",t)},expression:"form.user.email"}})],1),s("b-form-group",{attrs:{label:"パスワード","label-for":"input-password"}},[s("b-form-input",{attrs:{id:"iput-password",type:"password",placeholder:"パスワード"},model:{value:e.form.user.password,callback:function(t){e.$set(e.form.user,"password",t)},expression:"form.user.password"}})],1),s("b-form-group",{attrs:{label:"パスワード確認用","label-for":"input-repassword"}},[s("b-form-input",{attrs:{id:"iput-repassword",type:"password",placeholder:"パスワード確認用"},model:{value:e.form.user.repassword,callback:function(t){e.$set(e.form.user,"repassword",t)},expression:"form.user.repassword"}})],1),s("b-form-row",[s("b-form-checkbox",{staticClass:"pr-2",model:{value:e.form.user.isSuperUser,callback:function(t){e.$set(e.form.user,"isSuperUser",t)},expression:"form.user.isSuperUser"}},[e._v("管理者権限")]),s("b-form-checkbox",{staticClass:"pr-2",model:{value:e.form.user.isStaff,callback:function(t){e.$set(e.form.user,"isStaff",t)},expression:"form.user.isStaff"}},[e._v("スタッフ権限")]),s("b-form-checkbox",{staticClass:"pr-2",model:{value:e.form.user.isActive,callback:function(t){e.$set(e.form.user,"isActive",t)},expression:"form.user.isActive"}},[e._v("ログイン権限")])],1),s("div",{staticClass:"row text-center mt-5"},[s("div",{staticClass:"col-sm-12"},[s("b-button",{attrs:{type:"submit",variant:"primary"}},[e._v("登録")])],1)])],1)],1)],1)},Y=[],Z={components:{GlobalHeader:j,GlobalMessage:U},data:function(){return{form:{user:{username:"",email:"",isSuperUser:!1,isStaff:!1,isActive:!0,password:"",repassword:""}}}},methods:{submitRegister:function(){var e=this;x.post("/auth/users/",{username:this.form.user.username,email:this.form.user.email,is_superuser:this.form.user.isSuperUser,is_staff:this.form.user.isStaff,is_active:this.form.user.isActive,password:this.form.user.password,re_password:this.form.user.repassword}).then((function(t){var s="登録しました。",r=t.data;e.$store.dispatch("message/setInfoMessage",{message:s}),e.form.user.username=r.username,e.form.user.email=r.email,e.form.user.isSuperUser=r.is_superuser,e.form.user.isStaff=r.is_staff,e.form.user.isActive=use.is_active}))}}},ee=Z,te=Object(i["a"])(ee,V,Y,!1,null,null,null),se=te.exports,re=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"profile-page"}},[s("GlobalHeader"),s("GlobalMessage"),s("main",{staticClass:"container"},[s("b-card",{staticClass:"overflow-hidden",staticStyle:{"max-width":"540px"},attrs:{"no-body":""}},[s("b-row",{attrs:{"no-gutters":""}},[s("b-col",{attrs:{md:"6"}},[s("b-card-img",{staticClass:"rounded-0",attrs:{src:"@/assets/ponkue_imura.png"}})],1),s("b-col",{attrs:{md:"6"}},[s("b-card-body",{attrs:{title:"Horizontal Card"}},[s("b-card-text",[e._v("\n              This is a wider card with supporting text as a natural lead-in to additional content.\n              This content is a little bit longer.\n            ")])],1)],1)],1)],1)],1)],1)},ae=[],oe={components:{GlobalHeader:j,GlobalMessage:U}},ne=oe,ie=Object(i["a"])(ne,re,ae,!1,null,null,null),le=ie.exports;r["default"].use(m["a"]);var ue=new m["a"]({mode:"history",routes:[{path:"/",component:H,meta:{requiresAuth:!0}},{path:"/users",component:Q,meta:{requiresAuth:!0},beforeEnter:function(e,t,s){var r=_.getters["auth/isSuperUser"],a=_.getters["auth/isStaff"],o=_.getters["auth/isActive"];console.log("isSuperUser=",r),console.log("isStaff=",a),console.log("isActive=",o),r||a?(console.log("User is Admin or Staff. So, free to next."),s()):o?(console.log("User is Normal. So, redirect to Top Page."),ce(e,t,s)):ce(e,t,s)}},{path:"/profile",component:le},{path:"/register",component:se,meta:{requiresAuth:!0}},{path:"/login",component:J},{path:"*",redirect:"/"}]});function ce(e,t,s){console.log("Force user to login page."),s({path:"/login",query:{next:e.fullPath}})}ue.beforeEach((function(e,t,s){var r=_.getters["auth/isLoggedIn"],a=localStorage.getItem("access");console.log("to.path=",e.path),console.log("isLoggedIn=",r),e.matched.some((function(e){return e.meta.requiresAuth}))?r?(console.log("User is already logged in. So, free to next."),s()):null!=a?(console.log("User is not logged in. Trying to reload again."),_.dispatch("auth/reload").then((function(){console.log("Succeeded to reload. So, free to next."),s()})).catch((function(){ce(e,t,s)}))):ce(e,t,s):(console.log("Go to public page."),s())}));var me=ue;r["default"].config.productionTip=!0,r["default"].use(a["a"]),new r["default"]({router:me,store:_,render:function(e){return e(c)}}).$mount("#app")},"64a9":function(e,t,s){}});
//# sourceMappingURL=app.677e8f0b.js.map